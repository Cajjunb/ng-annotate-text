(function(){var a,b,c,d,e,f,g;d=angular.module("ngAnnotate",[]),e=function(a,b){var c,d,e,f;for(b.sort(function(a,b){return a.endIndex<b.endIndex?-1:a.endIndex>b.endIndex?1:0}),d=e=f=b.length-1;e>=0;d=e+=-1)c=b[d];return a},a=function(a,b){var c,d,e,f,g,h,i,j,k;for(e=$('<div class="ng-annotation-popup ng-annotation-popup-'+a+'" />'),i=0,j=b.length;j>i;i++)h=b[i],g=$("<label>"+h.label+"</label>"),"textarea"===h.type?f=$("<textarea />",{"class":h.classes,name:h.name,"ng-model":"annotation."+h.name}):("number"===(k=h.type)||"text"===k||"date"===k||"password"===k)&&(f=$("<input />",{type:h.type,"class":h.classes,name:h.name,"ng-model":"annotation."+h.name})),e.append(g),e.append(f);return c=$("<button>Accept</button>").addClass("ng-annotate-accept"),d=$("<button>Close</button>").addClass("ng-annotate-close"),e.append([c,d]),e},f=function(a){return a.unwrap()},b=function(){return Math.floor(1e5*Math.random())},c=function(){var a;if(a=window.getSelection(),"Range"!==a.type)throw new Error("NG_ANNOTATE_NO_TEXT_SELECTED");return a},g=function(a){var b,d,e;e=c(),d=e.getRangeAt(0);try{return d.surroundContents(a)}catch(f){if(b=f,"InvalidStateError"===b.name)throw new Error("NG_ANNOTATE_PARTIAL_NODE_SELECTED");throw b}},d.directive("ngAnnotate",function(c,d,e,h){return{restrict:"A",link:function(i,j,k){var l,m,n,o;return o={annotations:"annotations",fields:[{name:"comment",label:"Comment",classes:"ng-annotation-comment",type:"textarea",defaultValue:'""'}]},l=[],o=angular.extend(o,c(k.ngAnnotate)(i)),m=c(k.ngAnnotateOnAnnotation),n=c(k.ngAnnotateOnError),j.on("mousedown",function(){var a,b;return b=a=!0}),j.on("mouseleave",function(){var a;return mouseDown?a=!1:void 0}),j.on("mouseenter",function(){var a;return mouseDown?a=!0:void 0}),j.on("mouseup",function(c){var k,l,p,q,r,s,t,u,v,w,x,y,z;if(containedToElement){for(t=!1,c.preventDefault(),p=b(),v=d.$new(),v.annotation={},z=o.fields,x=0,y=z.length;y>x;x++)r=z[x],v.annotation[r.name]=r.defaultValue;k=$("<span />",{"class":"ng-annotation ng-annotation-"+p});try{g(k.get(0))}catch(A){return q=A,void h(function(){return n(i,{$ex:q})})}return u=k.offset(),w=k.innerWidth(),s=k.innerHeight(),l=a(p,o.fields),l.css({left:j.offset().left-320,top:u.top-s/2-l.innerHeight()/2}),e(l.get(0))(v,function(a,b){return a.appendTo("body"),a.fadeIn("slow"),a.find(".ng-annotate-accept").on("click",function(a){return a.preventDefault(),h(function(){return m(i,{$annotation:b.annotation})})}),a.find(".ng-annotate-close").on("click",function(c){return c.preventDefault(),f(k),a.find("button").off("click"),a.fadeOut("slow",function(){return b.$destroy()})})})}})}}})}).call(this);