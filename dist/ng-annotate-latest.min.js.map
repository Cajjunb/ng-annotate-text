{"version":3,"file":"ng-annotate-latest.min.js","sources":["ng-annotate.coffee"],"names":[],"mappings":"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","sourcesContent":["ngAnnotate = angular.module \"ngAnnotate\", []\n\ninsertAt = (text, index, string)->\n\treturn text.substr(0, index) + string + text.substr(index)\n\nsortAnnotationsByEndIndex = (annotations)->\n\treturn annotations.sort (a, b)->\n\t\tif a.endIndex < b.endIndex\n\t\t\treturn -1\n\t\telse if a.endIndex > b.endIndex\n\t\t\treturn 1\n\t\treturn 0\n\nparseAnnotations = (text, annotations = [], indexOffset = 0)->\n\tif annotations.length is 0\n\t\treturn text\n\tannotations = sortAnnotationsByEndIndex annotations\n\n\tfor i in [annotations.length - 1..0] by -1\n\t\tannotation = annotations[i];\n\t\ttext = insertAt text, annotation.endIndex + indexOffset, \"</span>\"\n\t\tif annotation.children.length\n\t\t\ttext = parseAnnotations text, annotation.children, annotation.startIndex + indexOffset\n\t\ttext = insertAt text, annotation.startIndex + indexOffset, \"<span class=\\\"ng-annotation ng-annotation-\" + annotation.id + \" ng-annotation-type-\" + annotation.type + \"\\\" data-annotation-id=\\\"\" + annotation.id + \"\\\">\"\n\treturn text\n\ngetAnnotationById = (annotations, aId)->\n\tfor a in annotations\n\t\tif aId is a.id\n\t\t\treturn a\n\t\tif a.children.length > 0\n\t\t\tan = getAnnotationById a.children, aId\n\t\t\tif an isnt undefined\n\t\t\t\treturn an\n\nngAnnotate.factory \"NGAnnotatePopup\", ->\n\tNGAnnotatePopup = (scope)->\n\n\t\tangular.extend @,\n\t\t\tscope: scope\n\t\t\t$el: angular.element \"<div class=\\\"ng-annotation-popup\\\" />\"\n\t\t\t$anchor: null\n\n\t\t\tshow: (cb = angular.noop, speed = \"fast\")->\n\t\t\t\t@$el.fadeIn speed, cb\n\t\t\t\tif typeof scope.onEditorShow is \"function\"\n\t\t\t\t\tscope.onEditorShow @$el\n\n\t\t\thide: (cb = angular.noop, speed = \"fast\")->\n\t\t\t\t@$el.fadeOut speed, cb\n\t\t\t\tif typeof scope.onEditorHide is \"function\"\n\t\t\t\t\tscope.onEditorHide @$el\n\n\t\t\tisVisible: ->\n\t\t\t\treturn @$el.is \":visible\"\n\n\t\t\tpositionTop: ->\n\t\t\t\tif not @$anchor?\n\t\t\t\t\tthrow new Error \"NG_ANNOTATE_NO_ANCHOR\"\n\n\t\t\t\tanchorOffsetTop = @$anchor.offset().top\n\t\t\t\tanchorHeight = @$anchor.innerHeight()\n\t\t\t\tpopupHeight = @$el.innerHeight()\n\t\t\t\t@$el.css\n\t\t\t\t\ttop: anchorOffsetTop + (anchorHeight / 2) - (popupHeight / 2)\n\n\t\t\tpositionLeft: (value)->\n\t\t\t\t@$el.css\n\t\t\t\t\tleft: value\n\n\t\t\tdestroy: (cb = angular.noop)->\n\t\t\t\tscope = @scope\n\t\t\t\t$el = @$el\n\t\t\t\t@hide ->\n\t\t\t\t\tcb()\n\t\t\t\t\tscope.$destroy()\n\t\t\t\t\t$el.remove()\n\n\treturn NGAnnotatePopup\n\nngAnnotate.factory \"NGAnnotateTooltip\", ->\n\tNGAnnotateTooltip = (scope)->\n\n\t\tangular.extend @,\n\t\t\tscope: scope,\n\t\t\t$el: angular.element \"<div class=\\\"ng-annotation-tooltip\\\" />\"\n\t\t\t$anchor: null\n\n\t\t\tshow: (cb = angular.noop, speed = \"fast\")->\n\t\t\t\t@$el.fadeIn speed, cb\n\n\t\t\thide: (cb = angular.noop, speed = \"fast\")->\n\t\t\t\t@$el.fadeOut speed, cb\n\n\t\t\tisVisible: ->\n\t\t\t\treturn @$el.is \":visible\"\n\n\t\t\tpositionTop: ->\n\t\t\t\tif not @$anchor?\n\t\t\t\t\tthrow new Error \"NG_ANNOTATE_NO_ANCHOR\"\n\n\t\t\t\tanchorOffsetTop = @$anchor.offset().top\n\t\t\t\tanchorHeight = @$anchor.innerHeight()\n\t\t\t\ttooltipHeight = @$el.innerHeight()\n\t\t\t\t@$el.css\n\t\t\t\t\ttop: Math.round anchorOffsetTop + (anchorHeight / 2) - (tooltipHeight / 2)\n\n\t\t\tpositionLeft: (value)->\n\t\t\t\t@$el.css\n\t\t\t\t\tleft: Math.round value\n\n\t\t\tdestroy: (cb = angular.noop)->\n\t\t\t\tscope = @scope\n\t\t\t\t$el = @$el\n\t\t\t\t@hide ->\n\t\t\t\t\tcb()\n\t\t\t\t\tscope.$destroy()\n\t\t\t\t\t$el.remove()\n\n\t\t\tstopDestroy: ->\n\t\t\t\t@$el.stop(true).show(\"fast\")\n\nngAnnotate.factory \"NGAnnotation\", ->\n\tAnnotation = (data)->\n\n\t\tangular.extend @,\n\t\t\tid: new Date().getTime(),\n\t\t\tstartIndex: null\n\t\t\tendIndex: null\n\t\t\tdata: {points: 0}\n\t\t\ttype: \"\"\n\t\t\tchildren: []\n\n\t\tif data?\n\t\t\tangular.extend @, data\n\n\treturn Annotation\n\nngAnnotate.directive \"ngAnnotate\", ($rootScope, $compile, $http, $q, $controller, $sce, NGAnnotation, NGAnnotatePopup, NGAnnotateTooltip)->\n\treturn {\n\t\trestrict: \"E\"\n\t\tscope:\n\t\t\ttext: \"=\"\n\t\t\tannotations: \"=\"\n\t\t\toptions: \"=\"\n\t\t\tonAnnotate: \"=\"\n\t\t\tonAnnotateDelete: \"=\"\n\t\t\tonAnnotateError: \"=\"\n\t\t\tonEditorShow: \"=\"\n\t\t\tonEditorHide: \"=\"\n\t\ttemplate: \"<p ng-bind-html=\\\"content\\\"></p>\"\n\t\treplace: true\n\t\tcompile: (tElement, tAttrs, transclude)->\n\t\t\tLEFT_MARGIN = -10\n\n\t\t\treturn ($scope, element, attrs)->\n\t\t\t\tactivePopup = null\n\t\t\t\tactiveTooltip = null\n\n\t\t\t\t# Cache the template when we fetch it\n\t\t\t\tpopupTemplateData = \"\"\n\t\t\t\ttooltipTemplateData = \"\"\n\n\t\t\t\tonAnnotationsChange = ->\n\t\t\t\t\tif not $scope.text? or !$scope.text.length\n\t\t\t\t\t\treturn\n\t\t\t\t\tt = parseAnnotations $scope.text, $scope.annotations\n\t\t\t\t\t$scope.content = $sce.trustAsHtml t\n\n\t\t\t\t# Annotation parsing\n\t\t\t\t$scope.$watch \"text\", onAnnotationsChange\n\t\t\t\t$scope.$watch \"annotations\", onAnnotationsChange, true\n\n\t\t\t\t# Setting options\n\t\t\t\toptions =\n\t\t\t\t\treadonly: false\n\t\t\t\t\tpopupController: \"\"\n\t\t\t\t\tpopupTemplateUrl: \"\"\n\t\t\t\t\ttooltipController: \"\"\n\t\t\t\t\ttooltipTemplateUrl: \"\"\n\t\t\t\toptions = angular.extend options, $scope.options\n\n\t\t\t\tclearPopup = ->\n\t\t\t\t\tif not activePopup?\n\t\t\t\t\t\treturn\n\t\t\t\t\ttId = activePopup.scope.$annotation.id\n\t\t\t\t\tactivePopup.destroy ->\n\t\t\t\t\t\tif activePopup.scope.$annotation.id is tId\n\t\t\t\t\t\t\tactivePopup = null\n\n\t\t\t\tclearTooltip = ->\n\t\t\t\t\ttooltip = activeTooltip\n\t\t\t\t\tif not tooltip?\n\t\t\t\t\t\treturn\n\t\t\t\t\ttooltip.destroy ->\n\t\t\t\t\t\tif activeTooltip is tooltip\n\t\t\t\t\t\t\tactiveTooltip = null\n\n\t\t\t\t$scope.$on \"$destroy\", ->\n\t\t\t\t\tclearPopup()\n\t\t\t\t\tclearTooltip()\n\n\t\t\t\tif options.popupTemplateUrl\n\t\t\t\t\t$http.get(options.popupTemplateUrl).then (response)->\n\t\t\t\t\t\tpopupTemplateData = response.data\n\n\t\t\t\tif options.tooltipTemplateUrl\n\t\t\t\t\t$http.get(options.tooltipTemplateUrl).then (response)->\n\t\t\t\t\t\ttooltipTemplateData = response.data\n\n\t\t\t\tremoveChildren = (annotation)->\n\t\t\t\t\tfor i in [annotation.children.length - 1..0] by -1\n\t\t\t\t\t\ta = annotation.children[i]\n\t\t\t\t\t\tremoveChildren a\n\t\t\t\t\t\ta.children.splice i, 1\n\n\t\t\t\tremoveAnnotation = (id, annotations)->\n\t\t\t\t\tfor a, i in annotations\n\t\t\t\t\t\tremoveAnnotation id, a.children\n\n\t\t\t\t\t\tif a.id is id\n\t\t\t\t\t\t\tremoveChildren a\n\t\t\t\t\t\t\tannotations.splice i, 1\n\t\t\t\t\t\t\treturn\n\n\t\t\t\tcreateAnnotation = ->\n\t\t\t\t\tannotation = new NGAnnotation()\n\t\t\t\t\tsel = window.getSelection()\n\n\t\t\t\t\tif sel.isCollapsed\n\t\t\t\t\t\tthrow new Error \"NG_ANNOTATE_NO_TEXT_SELECTED\"\n\n\t\t\t\t\trange = sel.getRangeAt 0\n\n\t\t\t\t\tif range.startContainer isnt range.endContainer\n\t\t\t\t\t\tthrow new Error \"NG_ANNOTATE_PARTIAL_NODE_SELECTED\"\n\n\t\t\t\t\tif range.startContainer.parentNode.nodeName is \"SPAN\" # Is a child annotation\n\t\t\t\t\t\tparentId = if (attrId = range.startContainer.parentNode.getAttribute(\"data-annotation-id\"))? then parseInt(attrId, 10)\n\t\t\t\t\t\tif parentId is undefined\n\t\t\t\t\t\t\tthrow new Error \"NG_ANNOTATE_ILLEGAL_SELECTION\"\n\t\t\t\t\t\tparentAnnotation = getAnnotationById $scope.annotations, parentId\n\n\t\t\t\t\t\tannotationParentCollection = parentAnnotation.children\n\t\t\t\t\telse\n\t\t\t\t\t\tannotationParentCollection = $scope.annotations\n\n\t\t\t\t\t# Does this selection has any siblings?\n\t\t\t\t\tif annotationParentCollection.length\n\t\t\t\t\t\t# Yup, find the previous sibling\n\t\t\t\t\t\tprevSiblingSpan = range.startContainer.previousSibling\n\t\t\t\t\t\tif prevSiblingSpan?\n\t\t\t\t\t\t\tprevSiblingId = if (attrId = prevSiblingSpan.getAttribute(\"data-annotation-id\"))? then parseInt(attrId, 10)\n\t\t\t\t\t\t\tif not prevSiblingId?\n\t\t\t\t\t\t\t\tthrow new Error \"NG_ANNOTATE_ILLEGAL_SELECTION\"\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tprevAnnotation = getAnnotationById $scope.annotations, prevSiblingId\n\t\t\t\t\t\t\tannotation.startIndex = prevAnnotation.endIndex + range.startOffset\n\t\t\t\t\t\t\tannotation.endIndex = prevAnnotation.endIndex + range.endOffset\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\t# Doesn't have a prev sibling, alrighty then\n\t\t\t\t\t\t\tannotation.startIndex = range.startOffset\n\t\t\t\t\t\t\tannotation.endIndex = range.endOffset\n\t\t\t\t\telse\n\t\t\t\t\t\t# Nope\n\t\t\t\t\t\tannotation.startIndex = range.startOffset\n\t\t\t\t\t\tannotation.endIndex = range.endOffset\n\n\t\t\t\t\tannotationParentCollection.push annotation\n\t\t\t\t\tclearSelection()\n\t\t\t\t\treturn annotation\n\n\t\t\t\tclearSelection = ->\n\t\t\t\t\tif document.selection\n\t\t\t\t\t\tdocument.selection.empty() # Internet Explorer\n\t\t\t\t\telse if window.getSelection and window.getSelection().empty\n\t\t\t\t\t\twindow.getSelection().empty() # Chrome\n\t\t\t\t\telse if window.getSelection and window.getSelection().removeAllRanges\n\t\t\t\t\t\twindow.getSelection().removeAllRanges() # Firefox\n\n\t\t\t\tonSelect = (event)->\n\t\t\t\t\tif popupTemplateData.length is 0\n\t\t\t\t\t\treturn\n\n\t\t\t\t\ttry\n\t\t\t\t\t\tannotation = createAnnotation()\n\t\t\t\t\t\t$scope.$apply()\n\t\t\t\t\t\t$span = element.find \".ng-annotation-\" + annotation.id\n\t\t\t\t\tcatch ex\n\t\t\t\t\t\tif $scope.onAnnotateError?\n\t\t\t\t\t\t\t$scope.onAnnotateError ex\n\n\t\t\t\t\t\treturn\n\n\t\t\t\t\tclearPopup()\n\t\t\t\t\tclearTooltip()\n\n\t\t\t\t\tloadAnnotationPopup annotation, $span, true\n\n\t\t\t\tonClick = (event)->\t\t\t\t\t\n\t\t\t\t\tif popupTemplateData.length is 0\n\t\t\t\t\t\treturn\n\n\t\t\t\t\t$target = angular.element event.target\n\t\t\t\t\ttargetId = if (attrId = $target.attr(\"data-annotation-id\"))? then parseInt(attrId, 10)\n\n\t\t\t\t\tif not targetId?\n\t\t\t\t\t\treturn\n\n\t\t\t\t\tif activePopup? and activePopup.scope.$annotation.id is targetId\n\t\t\t\t\t\tclearPopup()\n\t\t\t\t\t\treturn\n\t\t\t\t\tannotation = getAnnotationById $scope.annotations, targetId\n\n\t\t\t\t\tclearPopup()\n\t\t\t\t\tclearTooltip()\n\n\t\t\t\t\tloadAnnotationPopup annotation, $target, false\n\n\t\t\t\tonMouseEnter = (event)->\n\t\t\t\t\tif tooltipTemplateData.length is 0\n\t\t\t\t\t\treturn\n\n\t\t\t\t\tevent.stopPropagation()\n\t\t\t\t\t$target = angular.element event.target\n\t\t\t\t\ttargetId = if (attrId = $target.attr(\"data-annotation-id\"))? then parseInt(attrId, 10)\n\n\t\t\t\t\tif activeTooltip? and activeTooltip.scope.$annotation.id is targetId\n\t\t\t\t\t\tactiveTooltip.stopDestroy()\n\t\t\t\t\t\treturn\n\t\t\t\t\telse\n\t\t\t\t\t\tclearTooltip()\n\n\t\t\t\t\tif not targetId?\n\t\t\t\t\t\treturn\n\n\t\t\t\t\tannotation = getAnnotationById $scope.annotations, targetId\n\n\t\t\t\t\t# We don't want to show the tooltip if a popup with the annotation is open\n\t\t\t\t\tif activePopup?\n\t\t\t\t\t\treturn\n\n\t\t\t\t\ttooltip = new NGAnnotateTooltip $rootScope.$new()\n\t\t\t\t\ttooltip.scope.$annotation = annotation\n\t\t\t\t\ttooltip.$anchor = $target\n\n\t\t\t\t\ttooltip.scope.$reposition = ->\n\t\t\t\t\t\ttooltip.positionTop()\n\t\t\t\t\t\tpaddingLeft = parseInt(element.css(\"padding-left\"))\n\n\t\t\t\t\t\tleftPos = element.offset().left + paddingLeft - tooltip.$el.innerWidth() + LEFT_MARGIN\n\n\t\t\t\t\t\tif leftPos < 0\n\t\t\t\t\t\t\tleftPos = 0\n\n\t\t\t\t\t\ttooltip.positionLeft leftPos\n\t\t\t\t\t\treturn\n\n\t\t\t\t\tactiveTooltip = tooltip\n\n\t\t\t\t\tlocals = \n\t\t\t\t\t\t$scope: tooltip.scope\n\t\t\t\t\t\t$template: tooltipTemplateData\n\n\t\t\t\t\ttooltip.$el.html locals.$template\n\t\t\t\t\ttooltip.$el.appendTo \"body\"\n\t\t\t\t\t\n\t\t\t\t\tif options.tooltipController\n\t\t\t\t\t\tcontroller = $controller options.tooltipController, locals\n\t\t\t\t\t\ttooltip.$el.data \"$ngControllerController\", controller\n\t\t\t\t\t\ttooltip.$el.children().data \"$ngControllerController\", controller\n\n\t\t\t\t\t$compile(tooltip.$el) tooltip.scope\n\t\t\t\t\ttooltip.scope.$reposition()\n\t\t\t\t\ttooltip.scope.$apply()\n\t\t\t\t\ttooltip.show()\n\n\t\t\t\tonMouseLeave = (event)->\n\t\t\t\t\tevent.stopPropagation()\n\n\t\t\t\t\t$target = angular.element event.target\n\t\t\t\t\ttargetId = if (attrId = $target.attr(\"data-annotation-id\"))? then parseInt(attrId, 10)\n\n\t\t\t\t\tif not targetId?\n\t\t\t\t\t\treturn\n\n\t\t\t\t\tclearTooltip()\n\n\t\t\t\tloadAnnotationPopup = (annotation, anchor, isNew)->\n\t\t\t\t\tpopup = new NGAnnotatePopup $rootScope.$new()\n\t\t\t\t\tpopup.scope.$isNew = isNew\n\t\t\t\t\tpopup.scope.$annotation = annotation\n\t\t\t\t\tpopup.scope.$readonly = options.readonly\n\t\t\t\t\tpopup.$anchor = anchor\n\t\t\t\t\tpopup.scope.onEditorShow = $scope.onEditorShow\n\t\t\t\t\tpopup.scope.onEditorHide = $scope.onEditorHide\n\n\t\t\t\t\tpopup.scope.$reject = ->\n\t\t\t\t\t\tremoveAnnotation annotation.id, $scope.annotations\n\t\t\t\t\t\t\n\t\t\t\t\t\tif $scope.onAnnotateDelete?\n\t\t\t\t\t\t\t$scope.onAnnotateDelete annotation\n\t\t\t\t\t\tclearPopup()\n\t\t\t\t\t\treturn\n\n\t\t\t\t\tpopup.scope.$close = ->\n\t\t\t\t\t\tif $scope.onAnnotate?\n\t\t\t\t\t\t\t$scope.onAnnotate popup.scope.$annotation\n\t\t\t\t\t\tclearPopup()\n\t\t\t\t\t\treturn\n\n\t\t\t\t\tpopup.scope.$reposition = ->\n\t\t\t\t\t\tpopup.positionTop()\n\t\t\t\t\t\tpaddingLeft = parseInt(element.css(\"padding-left\"))\n\n\t\t\t\t\t\tleftPos = element.offset().left + paddingLeft - popup.$el.innerWidth() + LEFT_MARGIN\n\n\t\t\t\t\t\tif leftPos < 0\n\t\t\t\t\t\t\tleftPos = 0\n\n\t\t\t\t\t\tpopup.positionLeft leftPos\n\t\t\t\t\t\treturn\n\n\t\t\t\t\tactivePopup = popup\n\n\t\t\t\t\tlocals = \n\t\t\t\t\t\t$scope: popup.scope\n\t\t\t\t\t\t$template: popupTemplateData\n\n\t\t\t\t\tpopup.$el.html locals.$template\n\t\t\t\t\tpopup.$el.appendTo \"body\"\n\t\t\t\t\t\n\t\t\t\t\tif options.popupController\n\t\t\t\t\t\tcontroller = $controller options.popupController, locals\n\t\t\t\t\t\tpopup.$el.data \"$ngControllerController\", controller\n\t\t\t\t\t\tpopup.$el.children().data \"$ngControllerController\", controller\n\n\t\t\t\t\t$compile(popup.$el) popup.scope\n\t\t\t\t\tpopup.scope.$reposition()\n\t\t\t\t\tpopup.scope.$apply()\n\t\t\t\t\tpopup.show()\n\n\t\t\t\telement.on \"mouseenter\", \"span\", onMouseEnter\n\t\t\t\telement.on \"mouseleave\", \"span\", onMouseLeave\n\n\t\t\t\telement.on \"mouseup\", (event)->\n\t\t\t\t\t# We need to determine if the user actually selected something\n\t\t\t\t\t# or if he just clicked on an annotation\n\t\t\t\t\tselection = window.getSelection()\n\t\t\t\t\tif !selection.isCollapsed and !options.readonly\n\t\t\t\t\t\t# User has selected something\n\t\t\t\t\t\tonSelect event\n\t\t\t\t\telse if selection.isCollapsed and event.target.nodeName is \"SPAN\"\n\t\t\t\t\t\tonClick event\n\t\t\t\t\telse if selection.isCollapsed\n\t\t\t\t\t\tclearTooltip()\n\t\t\t\t\t\tclearPopup()\n\t}\n"],"sourceRoot":"/source/"}